@page "/EditProviders"
@inherits PageCore<EditProviders>
@inject HttpClient Http
@using System.Linq
@using MyStream.Core
@using MyStream.Modal.Tmdb
@using System.IO
@using System.Text.Json

<DataGrid @ref="DataGrid" TItem="ProviderBase" Data="@ListData" Filterable="true" Editable="true" EditMode="DataGridEditMode.Popup" 
    ShowPager="true" PageSize="10" FilterMethod="DataGridFilterMethod.Contains"
    RowInserting="RowInserting" RowInserted="RowInserted" >
    <DataGridCommandColumn TItem="ProviderBase" Width="110px">
        <ClearFilterCommandTemplate>
            <Button Color="Color.Secondary" Clicked="@context.Clicked" Size="Size.Small">
                <Blazorise.Icon Name="FontAwesomeIcons.Filter"></Blazorise.Icon>
            </Button>
		</ClearFilterCommandTemplate>
        <NewCommandTemplate>
            <Button Color="Color.Success" Clicked="@context.Clicked" Size="Size.Small">
                <Blazorise.Icon Name="FontAwesomeIcons.Plus"></Blazorise.Icon>
            </Button>
        </NewCommandTemplate>
        <EditCommandTemplate>
            <Button Color="Color.Primary" Clicked="@context.Clicked" Size="Size.Small" Margin="Margin.Is1.FromRight">
                <Blazorise.Icon Name="FontAwesomeIcons.Edit"></Blazorise.Icon>
			</Button>
        </EditCommandTemplate>
        <DeleteCommandTemplate>
            <Button Color="Color.Danger" Clicked="@context.Clicked" Size="Size.Small">
                <Blazorise.Icon Name="FontAwesomeIcons.Trash"></Blazorise.Icon>
			</Button>
        </DeleteCommandTemplate>
    </DataGridCommandColumn>
    @*<DataGridColumn TItem="ProviderBase" Field="@nameof(ProviderBase.display_priority)" Caption="display_priority" />*@
    @*<DataGridColumn TItem="ProviderBase" Field="@nameof(ProviderBase.logo_path)" Caption="logo_path" />*@
    <DataGridColumn TItem="ProviderBase" Field="@nameof(ProviderBase.provider_id)" Caption="provider_id" Width="100px" />
    <DataGridColumn TItem="ProviderBase" Field="@nameof(ProviderBase.provider_name)" Caption="provider_name" />
    <DataGridColumn TItem="ProviderBase" Field="@nameof(ProviderBase.provider_desciption)" Caption="provider_desciption" Editable="true" />
    <DataGridColumn TItem="ProviderBase" Field="@nameof(ProviderBase.provider_link)" Caption="provider_link" Editable="true" />
</DataGrid>

@code {
    public DataGrid<ProviderBase> DataGrid { get; set; }
    public List<ProviderBase> ListData { get; set; } = new();

    protected override async Task LoadData()
    {
        var temp = await Http.GetFromJsonAsync<TMDB_AllProviders>("Data/providers.json");
        ListData = temp.results;
    }

    protected async Task RowInserting(CancellableRowChange<ProviderBase, Dictionary<string, object>> e)
    {
        var obj_new = e.Item;
        var obj_old = ListData.First(f => f.provider_id == obj_new.provider_id);

        obj_old = obj_new;
    }

    protected async Task RowInserted(SavedRowItem<ProviderBase, Dictionary<string, object>> e)
    {
        var obj_new = e.Item;
        var obj_old = ListData.First(f => f.provider_id == obj_new.provider_id);

        obj_old = obj_new;
    }
}