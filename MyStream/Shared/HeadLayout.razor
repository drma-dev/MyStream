@inherits ComponenteCore
@using MyStream.Modal.Enum
@inject Settings Settings

<Bar Mode="BarMode.Horizontal" Background="Background.Secondary" ThemeContrast="ThemeContrast.Dark">
    <BarBrand>
        <Select TValue="Region" SelectedValue="@Settings.Region" SelectedValueChanged="RegionValueChanged" Size="Size.Small" Style="width:auto;" Margin="Margin.Is2.FromRight">
            @foreach (var item in Regions.OrderBy(o => o.Name))
            {
                <SelectItem Value="@item.ValueObject">@item.Name</SelectItem>
            }
        </Select>
        <Select TValue="Language" SelectedValue="@Settings.Language" SelectedValueChanged="LanguageValueChanged" Size="Size.Small" Style="width:auto;">
            @foreach (var item in Languages.Where(w => !string.IsNullOrEmpty(w.Name)).OrderBy(o => o.Name))
            {
                <SelectItem Value="@item.ValueObject">@item.Name</SelectItem>
            }
        </Select>
    </BarBrand>
</Bar>

@code{
    public List<EnumList> Regions { get; set; } = new();
    public List<EnumList> Languages { get; set; } = new();

    protected override void OnInitialized()
    {
        base.OnInitialized();

        LoadData();
    }

    protected void LoadData()
    {
        Regions = EnumHelper.GetList(typeof(Region));
        Languages = EnumHelper.GetList(typeof(Language));
    }

    protected async Task RegionValueChanged(Region value)
    {
        var sett = Settings;

        sett.Region = value;

        StorageService.Local.SetItem("Settings", sett);

        await RefreshCore.ChangeRegion(value);
    }

    protected async Task LanguageValueChanged(Language value)
    {
        var sett = Settings;

        sett.Language = value;

        StorageService.Local.SetItem("Settings", sett);

        await RefreshCore.ChangeLanguage(value);
    }
}